@model GiftOfTheGiversApp.Models.ResourceRequest
@{
    ViewData["Title"] = "Request Details";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-eye"></i> Request Details</h1>
    <div>
        <a class="btn btn-outline-secondary" asp-action="Index">
            <i class="bi bi-arrow-left"></i> Back to Requests
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Request Information</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Disaster:</dt>
                    <dd class="col-sm-8">
                        <strong>@Model.Disaster?.Name</strong>
                        <br />
                        <small class="text-muted">@Model.Disaster?.Location</small>
                    </dd>

                    <dt class="col-sm-4">Resource Needed:</dt>
                    <dd class="col-sm-8">
                        <strong>@Model.Resource?.Name</strong>
                        <br />
                        <small class="text-muted">@Model.Resource?.Category?.CategoryName</small>
                        <br />
                        <small class="text-muted">Current Stock: @Model.Resource?.CurrentQuantity</small>
                    </dd>

                    <dt class="col-sm-4">Quantity Requested:</dt>
                    <dd class="col-sm-8">
                        <span class="badge bg-primary">@Model.QuantityRequested</span>
                    </dd>

                    <dt class="col-sm-4">Urgency Level:</dt>
                    <dd class="col-sm-8">
                        <span class="badge @GetUrgencyBadge(Model.UrgencyLevel)">@Model.UrgencyLevel</span>
                    </dd>

                    <dt class="col-sm-4">Status:</dt>
                    <dd class="col-sm-8">
                        <span class="badge @GetStatusBadge(Model.Status)">@Model.Status</span>
                    </dd>

                    <dt class="col-sm-4">Requested By:</dt>
                    <dd class="col-sm-8">@Model.RequestedBy?.FullName</dd>

                    <dt class="col-sm-4">Date Requested:</dt>
                    <dd class="col-sm-8">@Model.DateRequested.ToString("MMMM dd, yyyy 'at' hh:mm tt")</dd>

                    @if (Model.DateRequired.HasValue)
                    {
                        <dt class="col-sm-4">Date Required:</dt>
                        <dd class="col-sm-8">@Model.DateRequired.Value.ToString("MMMM dd, yyyy")</dd>
                    }
                </dl>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a class="btn btn-warning" asp-action="Edit" asp-route-id="@Model.Id">
                        <i class="bi bi-pencil"></i> Edit Request
                    </a>

                    @if (Model.Status == "Pending" || Model.Status == "Approved")
                    {
                        <form asp-action="Fulfill" method="post" class="d-inline">
                            <input type="hidden" name="id" value="@Model.Id" />
                            <button type="submit" class="btn btn-success w-100"
                                    onclick="return confirm('Fulfill this request? This will deduct @Model.QuantityRequested from inventory.')">
                                <i class="bi bi-check-circle"></i> Fulfill Request
                            </button>
                        </form>
                    }

                    <a class="btn btn-danger" asp-action="Delete" asp-route-id="@Model.Id">
                        <i class="bi bi-trash"></i> Delete Request
                    </a>
                </div>

                <!-- Status Update -->
                <hr />
                <h6>Update Status:</h6>
                <form asp-action="UpdateStatus" method="post" class="d-inline w-100">
                    <input type="hidden" name="id" value="@Model.Id" />
                    <div class="btn-group w-100">
                        <button type="submit" name="status" value="Pending" class="btn btn-sm btn-warning">Pending</button>
                        <button type="submit" name="status" value="Approved" class="btn btn-sm btn-info">Approve</button>
                        <button type="submit" name="status" value="Fulfilled" class="btn btn-sm btn-success">Fulfilled</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@functions {
    public string GetStatusBadge(string status)
    {
        return status?.ToLower() switch
        {
            "pending" => "bg-warning",
            "approved" => "bg-info",
            "fulfilled" => "bg-success",
            _ => "bg-secondary"
        };
    }

    public string GetUrgencyBadge(string urgency)
    {
        return urgency?.ToLower() switch
        {
            "critical" => "bg-danger",
            "high" => "bg-warning",
            "normal" => "bg-info",
            "low" => "bg-secondary",
            _ => "bg-secondary"
        };
    }
}